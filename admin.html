<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.tailwindcss.com https://cdnjs.cloudflare.com https://api.cloudinary.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com; img-src 'self' data: https: blob:; connect-src 'self' https://api.cloudinary.com; frame-src 'self';">
    <title>IRON LEGACY | COMMAND CENTER</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="./assets/css/style.css">
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Oswald:wght@500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- QR Code Lib -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- html2canvas for screenshot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        accent: '#EAB308',
                        dark: '#0F172A',
                        light: '#F8FAFC'
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Oswald', 'sans-serif'],
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-slate-100 text-dark overflow-hidden h-screen">

    <!-- LOGIN OVERLAY -->
    <div id="login-overlay" class="fixed inset-0 z-50 bg-white/30 backdrop-blur-xl flex items-center justify-center">
        <div
            class="bg-white p-10 rounded-2xl shadow-2xl border border-white/50 w-full max-w-md relative overflow-hidden">
            <!-- Decorative Glow -->
            <div class="absolute top-0 right-0 w-32 h-32 bg-primary/20 rounded-full blur-3xl -mr-10 -mt-10"></div>

            <div class="text-center mb-8 relative z-10">
                <h1 class="text-4xl font-display font-bold italic mb-2">IRON<span class="text-primary">LEGACY</span>
                </h1>
                <p class="text-gray-500 font-bold tracking-widest text-xs uppercase">Restricted Access</p>
            </div>

            <form id="login-form" class="space-y-6 relative z-10">
                <div>
                    <label class="block text-xs font-bold text-gray-400 uppercase mb-2">Command ID</label>
                    <input type="text" id="admin-user" class="neo-input" placeholder="Enter ID" required>
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-400 uppercase mb-2">Security Key</label>
                    <input type="password" id="admin-pass" class="neo-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit" class="btn-primary w-full shadow-xl">AUTHENTICATE</button>
            </form>
            <p id="login-error" class="text-red-500 text-sm text-center mt-4 hidden font-bold animate-pulse">ACCESS
                DENIED</p>
        </div>
    </div>

    <!-- MAIN DASHBOARD -->
    <div id="dashboard" class="flex h-screen opacity-0 pointer-events-none transition-opacity duration-1000">

        <!-- SIDEBAR -->
        <aside class="w-64 bg-white border-r border-gray-200 hidden md:flex flex-col">
            <div class="h-20 flex items-center justify-center border-b border-gray-100">
                <h2 class="text-2xl font-display font-bold italic">IRON<span class="text-primary">ADMIN</span></h2>
            </div>
            <nav class="flex-1 p-6 space-y-4">
                <a href="#" class="flex items-center space-x-3 text-primary font-bold bg-blue-50 px-4 py-3 rounded-xl">
                    <i class="fas fa-user-plus"></i>
                    <span>New Member</span>
                </a>
                <!-- Link to Analytics or List could go here -->
            </nav>
            <div class="p-6 border-t border-gray-100">
                <button onclick="location.reload()"
                    class="flex items-center space-x-3 text-gray-500 hover:text-red-500 transition-colors">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>System Logout</span>
                </button>
            </div>
        </aside>

        <!-- CONTENT AREA -->
        <main class="flex-1 overflow-y-auto p-4 md:p-8 relative">
            <!-- Top Bar -->
            <div class="flex justify-between items-center mb-8">
                <h1 class="text-3xl font-display font-bold">MEMBER GENERATOR</h1>
                <div class="flex items-center gap-4">
                    <span class="h-3 w-3 bg-green-500 rounded-full animate-pulse"></span>
                    <span class="text-sm font-bold text-gray-400">SYSTEM SECURE</span>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

                <!-- LEFT COLUMN: INPUTS -->
                <div class="space-y-8">
                    <!-- 1. Member Details -->
                    <div class="neo-card p-6 bg-white">
                        <h3 class="text-lg font-bold text-gray-800 mb-6 border-b border-gray-100 pb-2"><i
                                class="fas fa-id-card mr-2 text-primary"></i> MEMBER INFO</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="text-xs font-bold text-gray-400 uppercase">Full Name</label>
                                <input type="text" id="m-name" class="neo-input mt-1" placeholder="e.g. Rahul Sharma">
                            </div>
                            <div>
                                <label class="text-xs font-bold text-gray-400 uppercase">WhatsApp Number</label>
                                <input type="tel" id="m-whatsapp" class="neo-input mt-1" placeholder="e.g. 919876543210" pattern="[0-9]{10,15}">
                                <p class="text-xs text-gray-400 mt-1">Enter with country code (e.g., 91 for India)</p>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="text-xs font-bold text-gray-400 uppercase">Plan Tier</label>
                                    <select id="m-plan" class="neo-input mt-1">
                                        <option value="Silver">Silver</option>
                                        <option value="Gold">Gold</option>
                                        <option value="Platinum">Platinum</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="text-xs font-bold text-gray-400 uppercase">Valid Until</label>
                                    <input type="date" id="m-expiry" class="neo-input mt-1">
                                </div>
                            </div>
                            <div>
                                <label class="text-xs font-bold text-gray-400 uppercase">Diet Plan</label>
                                <textarea id="m-diet" class="neo-input mt-1" rows="4" placeholder="e.g. Breakfast: Oats with fruits&#10;Lunch: Chicken with rice&#10;Dinner: Salad with eggs"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- 2. Multimedia Assets -->
                    <div class="neo-card p-6 bg-white">
                        <h3 class="text-lg font-bold text-gray-800 mb-6 border-b border-gray-100 pb-2"><i
                                class="fas fa-cloud-upload-alt mr-2 text-accent"></i> ASSETS (Cloudinary)</h3>

                        <!-- Music Upload -->
                        <div class="mb-6">
                            <label class="text-xs font-bold text-gray-400 uppercase">Anthem (MP3)</label>
                            <div id="drop-music"
                                class="mt-2 border-2 border-dashed border-gray-300 rounded-xl p-6 text-center hover:bg-gray-50 transition-colors cursor-pointer relative overflow-hidden group">
                                <input type="file" id="file-music" accept="audio/*"
                                    class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                                <i
                                    class="fas fa-music text-3xl text-gray-300 mb-2 group-hover:text-primary transition-colors"></i>
                                <p class="text-sm text-gray-500 font-medium">Drop MP3 Here</p>
                                <div id="status-music" class="text-xs text-green-500 font-bold mt-2 hidden">UPLOADED
                                </div>
                            </div>
                            <input type="hidden" id="url-music">
                        </div>

                        <!-- Photo Upload -->
                        <div>
                            <label class="text-xs font-bold text-gray-400 uppercase">Transformation (JPG/PNG)</label>
                            <div id="drop-photo"
                                class="mt-2 border-2 border-dashed border-gray-300 rounded-xl p-6 text-center hover:bg-gray-50 transition-colors cursor-pointer relative overflow-hidden group">
                                <input type="file" id="file-photo" accept="image/*"
                                    class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                                <i
                                    class="fas fa-camera text-3xl text-gray-300 mb-2 group-hover:text-accent transition-colors"></i>
                                <p class="text-sm text-gray-500 font-medium">Drop Photo Here</p>
                                <div id="status-photo" class="text-xs text-green-500 font-bold mt-2 hidden">UPLOADED
                                </div>
                            </div>
                            <input type="hidden" id="url-photo">
                        </div>
                    </div>
                </div>

                <!-- RIGHT COLUMN: ACTIONS & RESULT -->
                <div class="space-y-8">
                    <!-- Action -->
                    <div class="neo-card p-6 bg-white flex flex-col items-center justify-center text-center">
                        <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mb-4">
                            <i class="fas fa-magic text-2xl text-primary"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-2">READY TO MINT?</h3>
                        <p class="text-gray-500 text-sm mb-6">This will generate a permanent digital ID card link.</p>
                        <button id="btn-generate" class="btn-primary w-full py-4 text-lg shadow-blue-500/20">GENERATE
                            DIGITAL CARD</button>
                    </div>

                    <!-- Result -->
                    <div id="result-panel" class="neo-card p-6 bg-slate-800 text-white hidden relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-32 h-32 bg-accent/20 rounded-full blur-3xl"></div>

                        <h3 class="text-lg font-bold mb-4 border-b border-gray-700 pb-2">DIGITAL PASSPORT ISSUED</h3>

                        <div class="flex flex-col md:flex-row gap-6 items-center">
                            <div class="bg-white p-2 rounded-lg" id="qrcode"></div>
                            <div class="flex-1 w-full relative z-10">
                                <p class="text-xs text-gray-400 uppercase font-bold mb-1">MEMBER LINK</p>
                                <div
                                    class="bg-black/50 p-3 rounded-lg flex items-center justify-between mb-4 border border-gray-700">
                                    <input type="text" id="final-link"
                                        class="bg-transparent border-none text-xs text-gray-300 w-full focus:outline-none font-mono"
                                        readonly>
                                    <button onclick="copyLink()" class="text-primary hover:text-white ml-2"><i
                                            class="fas fa-copy"></i></button>
                                </div>
                                <div class="flex gap-2">
                                    <a href="" id="preview-link" target="_blank"
                                        class="flex-1 text-center bg-accent text-black font-bold py-2 rounded-lg hover:bg-yellow-300 transition-colors text-xs uppercase tracking-wider">
                                        OPEN CARD <i class="fas fa-external-link-alt ml-1"></i>
                                    </a>
                                    <button onclick="shareOnWhatsApp()" 
                                        class="flex-1 text-center bg-green-500 text-white font-bold py-2 rounded-lg hover:bg-green-600 transition-colors text-xs uppercase tracking-wider">
                                        <i class="fab fa-whatsapp mr-1"></i> SHARE
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- MAIN LOGIC SCRIPT -->
    <script src="./assets/js/admin.js"></script>
    <script>
        // DOM ELEMENTS
        const loginOverlay = document.getElementById('login-overlay');
        const loginForm = document.getElementById('login-form');
        const dashboard = document.getElementById('dashboard');

        // 1. LOGIN HANDLER
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const u = document.getElementById('admin-user').value;
            const p = document.getElementById('admin-pass').value;

            // Use Function from admin.js
            const isValid = await window.AdminCore.verifyAdmin(u, p);

            if (isValid) {
                // Success Animation
                loginOverlay.classList.add('opacity-0', 'pointer-events-none');
                dashboard.classList.remove('hidden');
                setTimeout(() => {
                    loginOverlay.style.display = 'none';
                    dashboard.classList.remove('opacity-0', 'pointer-events-none');
                }, 500);
            } else {
                // Error Shake
                const err = document.getElementById('login-error');
                err.classList.remove('hidden');
                loginForm.classList.add('animate-pulse');
                setTimeout(() => loginForm.classList.remove('animate-pulse'), 500);
            }
        });

        // 2. UPLOAD HANDLERS
        async function handleUpload(fileInputId, hiddenInputId, statusId) {
            const input = document.getElementById(fileInputId);
            const hidden = document.getElementById(hiddenInputId);
            const status = document.getElementById(statusId);

            if (input.files.length > 0) {
                const file = input.files[0];
                status.textContent = "UPLOADING...";
                status.classList.remove('hidden', 'text-green-500');
                status.classList.add('text-yellow-500');

                const url = await window.AdminCore.uploadToCloudinary(file);

                if (url) {
                    hidden.value = url;
                    status.textContent = "UPLOAD COMPLETE";
                    status.classList.remove('text-yellow-500');
                    status.classList.add('text-green-500');
                } else {
                    status.textContent = "FAILED";
                    status.classList.add('text-red-500');
                }
            }
        }

        document.getElementById('file-music').addEventListener('change', () => handleUpload('file-music', 'url-music', 'status-music'));
        document.getElementById('file-photo').addEventListener('change', () => handleUpload('file-photo', 'url-photo', 'status-photo'));

        // 3. GENERATE LINK & QR
        document.getElementById('btn-generate').addEventListener('click', () => {
            const name = document.getElementById('m-name').value;
            const plan = document.getElementById('m-plan').value;
            const expiry = document.getElementById('m-expiry').value;
            const music = document.getElementById('url-music').value;
            const photo = document.getElementById('url-photo').value;
            const diet = document.getElementById('m-diet').value;

            if (!name || !expiry) {
                alert("Please fill Name and Expiry Name!");
                return;
            }

            // Construct URL
            const baseUrl = window.location.href.replace('admin.html', 'member-card.html');
            const params = new URLSearchParams({
                name: name,
                plan: plan,
                expiry: expiry,
                song: music,
                photo: photo,
                diet: diet
            });
            const finalUrl = `${baseUrl}?${params.toString()}`;

            // Show Result
            document.getElementById('result-panel').classList.remove('hidden');
            document.getElementById('final-link').value = finalUrl;
            document.getElementById('preview-link').href = finalUrl;

            // Generate QR
            const qrContainer = document.getElementById('qrcode');
            qrContainer.innerHTML = ""; // Clear prev
            new QRCode(qrContainer, {
                text: finalUrl,
                width: 100,
                height: 100
            });
        });

        function copyLink() {
            const copyText = document.getElementById("final-link");
            copyText.select();
            document.execCommand("copy");
            alert("Link Copied!");
        }

        async function shareOnWhatsApp() {
            const whatsappNumber = document.getElementById('m-whatsapp').value;
            const cardLink = document.getElementById("final-link").value;
            const memberName = document.getElementById('m-name').value;
            
            if (!whatsappNumber) {
                alert('Please enter WhatsApp number!');
                return;
            }

            // Clean phone number (remove spaces, dashes, plus)
            const cleanNumber = whatsappNumber.replace(/[\s+-]/g, '');
            
            // Simple message with card link
            const message = `üèãÔ∏è *IRON LEGACY - Digital Membership Card* üèãÔ∏è

üë§ *Member:* ${memberName}

üé¥ *View Your Digital Card:*
${cardLink}

üí™ Welcome to IRON LEGACY!
Build Your Legacy, Choose Your Power! üî•`;

            // Encode message for URL
            const encodedMessage = encodeURIComponent(message);
            
            // Open WhatsApp with specific number
            window.open(`https://wa.me/${cleanNumber}?text=${encodedMessage}`, '_blank');
        }
    </script>
</body>

</html>