<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IRON LEGACY | DIGITAL ID</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="./assets/css/style.css">
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Oswald:wght@500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        accent: '#EAB308',
                        dark: '#0F172A',
                        light: '#F8FAFC'
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Oswald', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        .holo-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.05) 100%);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 
                        inset 0 0 30px rgba(255, 255, 255, 0.1);
        }

        .light-mode {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .dark-mode {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }

        .light-mode .holo-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.85) 100%);
            border: 2px solid rgba(102, 126, 234, 0.3);
            box-shadow: 0 20px 60px rgba(102, 126, 234, 0.3);
        }

        .light-mode .text-card-primary {
            color: #1e293b !important;
        }

        .light-mode .text-card-secondary {
            color: #475569 !important;
        }

        .dark-mode .text-card-primary {
            color: #ffffff !important;
        }

        .dark-mode .text-card-secondary {
            color: #cbd5e1 !important;
        }

        .valid-glow {
            animation: glow-pulse 2s ease-in-out infinite;
        }

        @keyframes glow-pulse {
            0%, 100% { box-shadow: 0 0 30px rgba(59, 130, 246, 0.5); }
            50% { box-shadow: 0 0 50px rgba(59, 130, 246, 0.8); }
        }

        .expired-glow {
            animation: red-pulse 2s ease-in-out infinite;
        }

        @keyframes red-pulse {
            0%, 100% { box-shadow: 0 0 30px rgba(239, 68, 68, 0.5); }
            50% { box-shadow: 0 0 50px rgba(239, 68, 68, 0.8); }
        }

        .glass-effect {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .light-mode .glass-effect {
            background: rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(102, 126, 234, 0.2);
        }
    </style>
</head>

<body class="dark-mode flex items-center justify-center min-h-screen p-2 sm:p-4 md:p-6 overflow-x-hidden relative transition-all duration-500">

    <!-- Theme Toggle Button -->
    <button onclick="toggleTheme()" class="fixed top-4 right-4 sm:top-6 sm:right-6 z-50 w-12 h-12 sm:w-14 sm:h-14 rounded-full glass-effect flex items-center justify-center text-white hover:scale-110 transition-transform">
        <i class="fas fa-sun theme-icon-light hidden text-yellow-400 text-xl"></i>
        <i class="fas fa-moon theme-icon-dark text-blue-300 text-xl"></i>
    </button>

    <!-- Background Animation -->
    <div class="absolute inset-0 z-0">
        <div class="absolute top-0 left-0 w-64 h-64 bg-primary/20 rounded-full blur-3xl -ml-10 -mt-10 animate-pulse">
        </div>
        <div class="absolute bottom-0 right-0 w-64 h-64 bg-accent/20 rounded-full blur-3xl -mr-10 -mb-10 animate-pulse">
        </div>
    </div>

    <!-- MAIN MEMBER CARD -->
    <div id="card-container" class="relative z-10 w-full max-w-[95vw] sm:max-w-md mx-auto">

        <!-- STATUS BADGE -->
        <div id="status-badge"
            class="absolute -top-3 -right-3 sm:-top-4 sm:-right-4 z-20 bg-green-500 text-white font-bold px-3 py-1 sm:px-4 rounded-full shadow-lg transform rotate-12 text-xs sm:text-sm border-2 border-white">
            ACTIVE MEMBER
        </div>

        <div class="holo-card rounded-2xl sm:rounded-3xl overflow-hidden p-4 sm:p-6 relative group transition-all duration-300 valid-glow"
            id="main-card">

            <!-- HEADER -->
            <div class="flex justify-between items-start mb-4 sm:mb-6">
                <div>
                    <h1 class="text-xl sm:text-2xl font-display font-bold italic text-card-primary text-shadow">IRON<span
                            class="text-accent">LEGACY</span></h1>
                    <p class="text-card-secondary text-[10px] sm:text-xs font-bold tracking-widest uppercase">Official Digital Key</p>
                </div>
                <i class="fas fa-wifi text-card-secondary animate-pulse"></i>
            </div>

            <!-- PHOTO AREA -->
            <div class="relative w-28 h-28 sm:w-36 sm:h-36 mx-auto mb-4 sm:mb-6 rounded-full p-1 bg-gradient-to-r from-primary via-purple-500 to-accent shadow-2xl">
                <div class="w-full h-full rounded-full overflow-hidden bg-slate-800 relative ring-4 ring-white/20">
                    <img id="u-photo" src="https://via.placeholder.com/150" class="w-full h-full object-cover"
                        alt="Member Photo">
                </div>
            </div>

            <!-- MEMBER DETAILS -->
            <div class="text-center mb-4 sm:mb-6">
                <h2 id="u-name" class="text-2xl sm:text-3xl font-display font-bold text-card-primary mb-2 drop-shadow-lg break-words px-2">MEMBER NAME</h2>
                <div id="u-plan"
                    class="inline-block glass-effect px-3 py-1 sm:px-4 sm:py-1.5 rounded-full text-xs sm:text-sm text-card-primary font-bold uppercase tracking-wider shadow-lg">
                    PLAN TYPE
                </div>
            </div>

            <!-- COUNTDOWN / EXPIRY -->
            <div class="glass-effect rounded-xl sm:rounded-2xl p-3 sm:p-5 mb-4 sm:mb-5 shadow-xl">
                <p class="text-[10px] sm:text-xs text-card-secondary font-bold uppercase text-center mb-2 sm:mb-3">VALIDITY STATUS</p>
                <div id="valid-timer" class="text-lg sm:text-2xl font-mono text-center text-accent font-bold drop-shadow-lg mb-2">
                    CALCULATING...
                </div>
                <div class="text-center">
                    <p class="text-xs text-card-secondary font-semibold">Valid Till: <span id="expiry-date" class="text-card-primary font-bold">--/--/----</span></p>
                </div>
            </div>

            <!-- MUSIC PLAYER -->
            <div id="music-player-container" class="hidden mb-5">
                <div class="flex items-center justify-between glass-effect p-3 rounded-xl shadow-lg">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-primary/30 rounded-full flex items-center justify-center text-card-primary">
                            <i class="fas fa-music"></i>
                        </div>
                        <div class="text-left">
                            <p class="text-xs text-card-primary font-bold">GYM ANTHEM</p>
                            <p class="text-[10px] text-card-secondary">Playing...</p>
                        </div>
                    </div>
                    <button id="toggle-music" class="text-card-primary hover:text-accent transition-colors">
                        <i class="fas fa-pause"></i>
                    </button>
                </div>
                <audio id="audio-player" loops></audio>
            </div>

            <!-- DIET PLAN BUTTON -->
            <div id="diet-section" class="hidden mb-5">
                <button onclick="toggleDiet()" class="w-full glass-effect p-4 rounded-xl shadow-lg hover:scale-105 transition-transform">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-green-500/30 rounded-full flex items-center justify-center">
                                <i class="fas fa-apple-alt text-green-500"></i>
                            </div>
                            <span class="text-card-primary font-bold text-sm">VIEW DIET PLAN</span>
                        </div>
                        <i class="fas fa-chevron-down text-card-secondary" id="diet-arrow"></i>
                    </div>
                </button>
                <div id="diet-content" class="hidden mt-3 glass-effect p-4 rounded-xl shadow-lg">
                    <div class="text-card-primary text-sm whitespace-pre-line leading-relaxed" id="diet-text">
                        Loading diet plan...
                    </div>
                </div>
            </div>

            <!-- FOOTER -->
            <div class="mt-4 sm:mt-6 text-center">
                <p class="text-[9px] sm:text-[10px] text-card-secondary font-mono mb-2 sm:mb-3">ID: <span id="card-id">Loading...</span></p>
                <div class="flex justify-center gap-4 sm:gap-6 text-card-secondary text-lg sm:text-xl">
                    <a href="index.html" class="hover:text-primary hover:scale-110 transition-all"><i class="fas fa-home"></i></a>
                    <a href="tel:1234567890" class="hover:text-accent hover:scale-110 transition-all"><i class="fas fa-phone"></i></a>
                </div>
            </div>

        </div>

        <!-- EXPIRED OVERLAY (Defaults to hidden) -->
        <div id="expired-overlay"
            class="hidden absolute inset-0 bg-red-900/90 backdrop-blur-md z-30 rounded-3xl flex flex-col items-center justify-center text-center p-6 border-4 border-red-500">
            <i class="fas fa-skull-crossbones text-6xl text-white mb-4 animate-bounce"></i>
            <h2 class="text-4xl font-display font-bold text-white mb-2">ACCESS DENIED</h2>
            <p class="text-red-200 font-bold mb-6">MEMBERSHIP EXPIRED</p>
            <p id="expired-date" class="text-white font-mono bg-red-800 px-4 py-2 rounded mb-6">Ended: ----</p>
            <a href="index.html" class="btn-accent text-xs">RENEW NOW</a>
        </div>

    </div>

    <!-- DIET CHART DRAWER (Bottom Sheet) -->
    <div class="fixed bottom-0 left-0 right-0 z-40 flex justify-center pb-4">
        <button onclick="document.getElementById('diet-drawer').classList.toggle('translate-y-full')"
            class="bg-white text-dark font-bold px-6 py-3 rounded-full shadow-lg hover:scale-105 transition-transform text-sm uppercase">
            <i class="fas fa-apple-alt mr-2 text-red-500"></i> View Diet Plan
        </button>
    </div>

    <div id="diet-drawer"
        class="fixed bottom-0 left-0 w-full h-[60vh] bg-white rounded-t-3xl transform translate-y-full transition-transform duration-300 z-50 p-6 overflow-y-auto shadow-2xl">
        <div class="w-12 h-1 bg-gray-300 rounded-full mx-auto mb-6"></div>
        <h3 class="text-2xl font-display font-bold mb-4 text-dark">Recommended Nutrition</h3>
        <div class="space-y-4">
            <div class="p-4 bg-blue-50 rounded-xl">
                <h4 class="font-bold text-primary mb-2">Morning</h4>
                <p class="text-sm text-gray-600">Oats, 3 Egg Whites, 1 Scoop Whey Protein</p>
            </div>
            <div class="p-4 bg-green-50 rounded-xl">
                <h4 class="font-bold text-green-600 mb-2">Lunch</h4>
                <p class="text-sm text-gray-600">Grilled Chicken Breast (200g), Rice (1 cup), Broccoli</p>
            </div>
            <div class="p-4 bg-orange-50 rounded-xl">
                <h4 class="font-bold text-orange-600 mb-2">Pre-Workout</h4>
                <p class="text-sm text-gray-600">Banana, Black Coffee, Peanut Butter Toast</p>
            </div>
            <div class="p-4 bg-purple-50 rounded-xl">
                <h4 class="font-bold text-purple-600 mb-2">Dinner</h4>
                <p class="text-sm text-gray-600">Fish/Paneer, Salad, Sweet Potato</p>
            </div>
        </div>
        <button onclick="document.getElementById('diet-drawer').classList.add('translate-y-full')"
            class="w-full mt-6 py-3 text-center text-gray-400 text-sm">Close</button>
    </div>

    <script src="./assets/js/gym-core.js"></script>
    <script>
        // Theme Toggle Function
        function toggleTheme() {
            const body = document.body;
            const lightIcon = document.querySelector('.theme-icon-light');
            const darkIcon = document.querySelector('.theme-icon-dark');
            
            if (body.classList.contains('dark-mode')) {
                body.classList.remove('dark-mode');
                body.classList.add('light-mode');
                lightIcon.classList.add('hidden');
                darkIcon.classList.remove('hidden');
            } else {
                body.classList.remove('light-mode');
                body.classList.add('dark-mode');
                darkIcon.classList.add('hidden');
                lightIcon.classList.remove('hidden');
            }
        }

        // Diet Toggle Function
        function toggleDiet() {
            const content = document.getElementById('diet-content');
            const arrow = document.getElementById('diet-arrow');
            content.classList.toggle('hidden');
            arrow.classList.toggle('fa-chevron-down');
            arrow.classList.toggle('fa-chevron-up');
        }

        // INIT
        const params = getQueryParams();
        const now = new Date();
        const expiryDate = new Date(params.expiry);

        // 1. POPULATE DATA
        document.getElementById('u-name').textContent = params.name;
        document.getElementById('u-plan').textContent = params.plan.toUpperCase() + " PLAN";
        document.getElementById('card-id').textContent = Math.random().toString(36).substr(2, 9).toUpperCase();
        
        // Format and display expiry date
        const formatDate = (date) => {
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        };
        document.getElementById('expiry-date').textContent = formatDate(expiryDate);

        if (params.photo) {
            document.getElementById('u-photo').src = params.photo;
        }

        // Diet Plan
        if (params.diet) {
            document.getElementById('diet-section').classList.remove('hidden');
            document.getElementById('diet-text').textContent = params.diet;
        }

        // 2. CHECK EXPIRY
        const isActive = expiryDate > now;

        if (!isActive) {
            // EXPIRED STATE
            document.getElementById('expired-overlay').classList.remove('hidden');
            document.getElementById('main-card').classList.remove('valid-glow');
            document.getElementById('main-card').classList.add('expired-glow');
            document.getElementById('status-badge').textContent = "EXPIRED";
            document.getElementById('status-badge').className = "absolute -top-4 -right-4 z-20 bg-red-600 text-white font-bold px-4 py-1 rounded-full shadow-lg transform rotate-12 text-sm border-2 border-white";
            document.getElementById('expired-date').textContent = "Ended: " + expiryDate.toDateString();
        } else {
            // ACTIVE STATE countdown
            const updateTimer = () => {
                const diff = expiryDate - new Date();
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                document.getElementById('valid-timer').textContent = `${days} DAYS LEFT`;
            };
            updateTimer();
        }

        // 3. MUSIC PLAYER
        if (params.song && isActive) {
            const container = document.getElementById('music-player-container');
            const audio = document.getElementById('audio-player');
            const toggle = document.getElementById('toggle-music');

            container.classList.remove('hidden');
            audio.src = params.song;

            // Try autoplay (might be blocked)
            audio.play().catch(e => console.log("Autoplay blocked, waiting for interaction"));

            let isPlaying = true;
            toggle.addEventListener('click', () => {
                if (isPlaying) {
                    audio.pause();
                    toggle.innerHTML = '<i class="fas fa-play"></i>';
                } else {
                    audio.play();
                    toggle.innerHTML = '<i class="fas fa-pause"></i>';
                }
                isPlaying = !isPlaying;
            });
        }
    </script>
</body>

</html>